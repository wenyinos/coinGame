{"version":3,"sources":["file:///D:/MyCoding/Cosos/coinGame/assets/scripts/combat/ctrl/CameraCtrl.ts"],"names":["Component","_decorator","Vec3","Quat","Vec2","Node","lerp","macro","input","Input","sys","EDITOR","aa","ccclass","property","type","executeInEditMode","tempVec3","tempVec3_2","tempQuat","tempVec2","tempVec2_2","DeltaFactor","CameraCtrl","visible","_center","_targetCenter","_touched","_targetRotation","_rotation","_radius","dis","radius","_targetRadius","v","target","_target","set","_startRotation","worldPosition","preview","resetCam","targetRotation","start","init","ENABLE_MULTI_TOUCH","enableTouch","on","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","resetTargetRotation","fromEuler","x","y","z","limitRotation","enableScaleRadius","platform","Platform","DESKTOP_BROWSER","MOUSE_WHEEL","onMouseWheel","followTargetRotationY","toEuler","worldRotation","event","touch","touches","getAllTouches","length","ctrl","joystick","changedTouches","getTouches","touch1","touch2","diffID","getID","i","element","getLocation","distance","delta","radiusScaleSpeed","Math","sign","min","maxRadius","max","minRadius","getDelta","setRotate","v2","rotateX","rotateAround","UP","scrollY","getScrollY","rotation","xRotationRange","lateUpdate","dt","targetHeight","slerp","rotateSpeed","followSpeed","transformQuat","FORWARD","multiplyScalar","add","node","position","lookAt"],"mappings":"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","sourcesContent":["import { Component, _decorator, Vec3, EventTouch, Touch, Quat, Vec2, Node, EventMouse, lerp, macro, input, Input,sys } from 'cc'\r\nimport { EDITOR } from 'cc/env';\r\nimport { aa } from '../../frame/FrameCore';\r\n\r\nconst { ccclass, property, type, executeInEditMode } = _decorator;\r\n\r\nlet tempVec3 = new Vec3();\r\nlet tempVec3_2 = new Vec3();\r\nlet tempQuat = new Quat();\r\nlet tempVec2 = new Vec2();\r\nlet tempVec2_2 = new Vec2();\r\nlet DeltaFactor = 1 / 200;\r\n\r\n@ccclass('CameraCtrl')\r\n@executeInEditMode(true)\r\nexport default class CameraCtrl extends Component {\r\n\r\n    @property enableTouch = true;\r\n    @property enableScaleRadius = false;\r\n    @property rotateSpeed = 1;\r\n    @property followSpeed = 1;\r\n    @property xRotationRange = new Vec2(5, 70);\r\n    @type(Node) _target: Node;\r\n    @property targetHeight = 1;\r\n    @property radiusScaleSpeed = 1;\r\n    @property minRadius = 5;\r\n    @property maxRadius = 10;\r\n    @property followTargetRotationY = true;\r\n\r\n    @property\r\n    get radius() {\r\n        return this._targetRadius;\r\n    }\r\n    set radius(v) {\r\n        this._targetRadius = v;\r\n    }\r\n\r\n    @type(Node)\r\n    get target() {\r\n        return this._target;\r\n    }\r\n    set target(v) {\r\n        this._target = v;\r\n        this._targetRotation.set(this._startRotation);\r\n        this._targetCenter.set(v!.worldPosition);\r\n    }\r\n\r\n    @property\r\n    get preview() {\r\n        return false\r\n    }\r\n    set preview(v) {\r\n        this.resetCam(0.1);\r\n    }\r\n\r\n    @property\r\n    get targetRotation(): Vec3 {\r\n        return this._startRotation;\r\n    }\r\n    set targetRotation(v: Vec3) {\r\n        this._targetRotation.set(v);\r\n        this._startRotation.set(v);\r\n    }\r\n\r\n\r\n    @property({ visible: false }) private _startRotation = new Vec3;\r\n    @property({ visible: false }) private _targetRadius = 10;\r\n\r\n    private _center = new Vec3;\r\n    private _targetCenter = new Vec3;\r\n    private _touched = false;\r\n    _targetRotation = new Vec3;\r\n    private _rotation = new Quat\r\n    private _radius = 10;\r\n    private dis = 0;\r\n\r\n    start() {\r\n\r\n        if (EDITOR) {\r\n            this.resetCam(1);\r\n            return;\r\n        }\r\n\r\n    }\r\n\r\n    init() {\r\n        macro.ENABLE_MULTI_TOUCH = true;\r\n\r\n        if(this.enableTouch){\r\n            input.on(Input.EventType.TOUCH_START, this.onTouchStart, this)\r\n            input.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this)\r\n            input.on(Input.EventType.TOUCH_END, this.onTouchEnd, this)\r\n            input.on(Input.EventType.TOUCH_CANCEL, this.onTouchEnd, this)\r\n        }\r\n\r\n\r\n        this.resetTargetRotation();\r\n        Quat.fromEuler(this._rotation, this._targetRotation.x, this._targetRotation.y, this._targetRotation.z);\r\n\r\n        if (this.target) {\r\n            this._targetCenter.set(this.target.worldPosition);\r\n            this._center.set(this._targetCenter);\r\n        }\r\n\r\n        this._radius = this.radius;\r\n\r\n        this.limitRotation()\r\n\r\n        if (this.enableScaleRadius && sys.platform == sys.Platform.DESKTOP_BROWSER) {\r\n            input.on(Input.EventType.MOUSE_WHEEL, this.onMouseWheel, this)\r\n        }\r\n\r\n    }\r\n\r\n    resetTargetRotation() {\r\n        let targetRotation = this._targetRotation.set(this._startRotation);\r\n        if (this.followTargetRotationY) {\r\n            targetRotation = tempVec3_2.set(targetRotation);\r\n            Quat.toEuler(tempVec3, this.target!.worldRotation);\r\n            targetRotation.y += tempVec3.y;\r\n        }\r\n    }\r\n\r\n    onTouchStart(event?: EventTouch) {\r\n        this._touched = true;\r\n    }\r\n\r\n    onTouchMove(event?: EventTouch) {\r\n\r\n        if (!this._touched) return;\r\n\r\n        const touch = event.touch;\r\n\r\n        const touches = event.getAllTouches();\r\n        /* scale radius for mobile multi touch */\r\n        if (touches.length > 1 && !aa.ctrl.joystick) {\r\n            const changedTouches = event.getTouches();\r\n\r\n            let touch1: Touch = null!;\r\n            let touch2: Touch = null!;\r\n            if (changedTouches.length > 1) {\r\n                touch1 = touches[0];\r\n                touch2 = touches[1];\r\n\r\n            } else {\r\n                touch1 = touch;\r\n                const diffID = touch1.getID();\r\n                for (let i = 0; i < touches.length; i++) {\r\n                    const element = touches[i];\r\n                    if (element.getID() !== diffID) {\r\n                        touch2 = element;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            touch1.getLocation(tempVec2);\r\n            touch2.getLocation(tempVec2_2);\r\n            let dis = Vec2.distance(tempVec2, tempVec2_2)\r\n            let delta = dis - this.dis\r\n            this._targetRadius += this.radiusScaleSpeed * -Math.sign(delta) * 0.3;\r\n            this._targetRadius = Math.min(this.maxRadius, Math.max(this.minRadius, this._targetRadius));\r\n            this.dis = dis;\r\n        }\r\n            tempVec2 = touch!.getDelta();\r\n            this.setRotate(tempVec2);\r\n    }\r\n\r\n    onTouchEnd() {\r\n        this._touched = false;\r\n    }\r\n\r\n    setRotate(v2: Vec2) {\r\n        Quat.fromEuler(tempQuat, this._targetRotation.x, this._targetRotation.y, this._targetRotation.z);\r\n        Quat.rotateX(tempQuat, tempQuat, -v2.y * DeltaFactor);\r\n        Quat.rotateAround(tempQuat, tempQuat, Vec3.UP, -v2.x * DeltaFactor);\r\n        Quat.toEuler(this._targetRotation, tempQuat);\r\n        this.limitRotation()\r\n    }\r\n\r\n\r\n    onMouseWheel(event: EventMouse) {\r\n        let scrollY = event.getScrollY();\r\n        this._targetRadius += this.radiusScaleSpeed * -Math.sign(scrollY);\r\n        this._targetRadius = Math.min(this.maxRadius, Math.max(this.minRadius, this._targetRadius));\r\n    }\r\n\r\n    limitRotation() {\r\n        let rotation = this._targetRotation;\r\n        if (rotation.x < this.xRotationRange.x) {\r\n            rotation.x = this.xRotationRange.x\r\n        }\r\n        else if (rotation.x > this.xRotationRange.y) {\r\n            rotation.x = this.xRotationRange.y\r\n        }\r\n    \r\n        rotation.z = 0;\r\n    }\r\n\r\n\r\n    lateUpdate(dt) {\r\n        this.resetCam(dt);\r\n    }\r\n\r\n    resetCam(dt) {\r\n        if(!this.target) return;\r\n\r\n        let targetRotation = this._targetRotation;\r\n        this._targetCenter.set(this.target.worldPosition);\r\n        this._targetCenter.y +=this.targetHeight;\r\n        Quat.fromEuler(tempQuat, targetRotation.x, targetRotation.y, targetRotation.z);\r\n\r\n        Quat.slerp(this._rotation, this._rotation, tempQuat, dt * 7 * this.rotateSpeed);\r\n\r\n        Vec3.lerp(this._center, this._center, this._targetCenter, dt * 5 * this.followSpeed);\r\n\r\n        this._radius = lerp(this._radius, this._targetRadius, dt * 10);\r\n\r\n        Vec3.transformQuat(tempVec3, Vec3.FORWARD, this._rotation);\r\n\r\n        Vec3.multiplyScalar(tempVec3, tempVec3, this._radius)\r\n        tempVec3.add(this._center)\r\n\r\n        this.node.position = tempVec3;\r\n        this.node.lookAt(this._center);\r\n    }\r\n\r\n}\r\n"]}