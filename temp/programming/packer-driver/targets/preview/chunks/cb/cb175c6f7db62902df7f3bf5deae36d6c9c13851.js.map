{"version":3,"sources":["file:///D:/MyCoding/Cosos/coinGame/assets/scripts/view/KeyConfigView.ts"],"names":["_decorator","director","instantiate","Node","Prefab","KeyBindingView","getComboName","aa","BaseView","ccclass","property","ctrl","KeyConfigView","currentBinding","_bindingViews","actionConfig","init","action","onEnable","global","isPause","on","onSelect","actions","getKeys","viewLenth","length","i","newBindingView","bindingView","parent","layout","getComponent","push","forEach","view","bindingName","config","get","keyLabel","combo","keyName","bg","EventType","TOUCH_END","clearSelect","onDisable","color","clearBinding","off","binding","updateBinding","nameLabel","string","close"],"mappings":"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","sourcesContent":["import { _decorator, Component, director, instantiate, Node, Prefab } from 'cc';\r\nimport { KeyBindingView } from './KeyBindingView';\r\nimport { getComboName } from '../frame/input/InputCtrl';\r\nimport { aa } from '../frame/FrameCore';\r\nimport { ActionConfig } from '../combat/ctrl/ActionConfig';\r\nimport { BaseView } from './BaseView';\r\nconst { ccclass, property } = _decorator;\r\nconst ctrl = aa.ctrl;\r\n@ccclass('KeyConfigView')\r\nexport class KeyConfigView extends BaseView {\r\n    @property(Node)\r\n    bg:Node = null;\r\n    @property(Prefab)\r\n    bindingView: Prefab = null;\r\n    @property(Node)\r\n    layout: Node = null;\r\n    currentBinding: KeyBindingView = null;\r\n    _bindingViews: KeyBindingView [] = [];\r\n    actionConfig: ActionConfig = null;\r\n\r\n    init(action:ActionConfig){\r\n        this.actionConfig = action;\r\n    }\r\n\r\n    onEnable(): void {\r\n        aa.global.isPause = true;\r\n        director.on(\"KeyBindingSelect\", this.onSelect, this);\r\n        let actions = aa.ctrl.getKeys();\r\n        const viewLenth = this._bindingViews.length;\r\n        if (viewLenth < actions.length) {\r\n            for(var i=viewLenth;i<actions.length;i++){\r\n                const newBindingView = instantiate(this.bindingView);\r\n                newBindingView.parent = this.layout;\r\n                const bindingView= newBindingView.getComponent(KeyBindingView);\r\n                this._bindingViews.push(bindingView);\r\n            }\r\n        }\r\n\r\n        this._bindingViews.forEach((view,i)=>{\r\n            const action = actions[i];\r\n            view.bindingName = action;\r\n            const config = ctrl.get(action);\r\n            if(config){\r\n                const keyLabel = getComboName(config.combo);\r\n                view.keyName = keyLabel;\r\n            }\r\n        })\r\n        this.bg&&this.bg.on(Node.EventType.TOUCH_END,this.clearSelect,this);\r\n    }\r\n  \r\n    onDisable(): void {\r\n        if (this.currentBinding) {\r\n            this.currentBinding.color = false;\r\n        }\r\n        ctrl.clearBinding();\r\n        this.bg&&this.bg.off(Node.EventType.TOUCH_END,this.clearSelect,this);\r\n\r\n        aa.global.isPause = false;\r\n    }\r\n    clearSelect(){\r\n        if (this.currentBinding) {\r\n            this.currentBinding.color = false;\r\n            this.currentBinding = null;\r\n        }\r\n        ctrl.clearBinding();\r\n    }\r\n\r\n    onSelect(binding: KeyBindingView) {\r\n        if (this.currentBinding) {\r\n            this.currentBinding.color = false;\r\n        }\r\n        ctrl.updateBinding(binding.nameLabel.string,binding.keyLabel);\r\n        this.currentBinding = binding;\r\n        binding.color = true;\r\n    }\r\n\r\n    close() {\r\n        super.close();\r\n    }\r\n\r\n\r\n}\r\n\r\n"]}