{"version":3,"sources":["file:///D:/MyCoding/Cosos/coinGame/assets/scripts/Main.ts"],"names":["_decorator","Camera","Canvas","Component","director","instantiate","Node","sys","aa","AssetType","events","ui","DEBUG","CameraCtrl","CoinMgr","ccclass","property","Main","_game","onLoad","ins","start","loadRes","initGame","createLayers","res","getUI","ToastView","ActionView","startGame","scene","getScene","canvas","getComponentInChildren","node","layer2D","global","i","utils","createUI","name","parent","layer3D","cameras","camera3D","camera2D","isMobile","JoystickView","getNode","cam","getComponent","target","player","init","emit","Toast","sound","startBgm","addComponent","loadBundle","Prefab","Sound"],"mappings":"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","sourcesContent":["import { _decorator, Camera, Canvas, Component, director, instantiate, Node, sys } from 'cc';\r\nimport { aa } from './frame/FrameCore';\r\nimport { AssetType, events, ui } from './frame/Enums';\r\nimport { DEBUG } from 'cc/env';\r\nimport CameraCtrl from './combat/ctrl/CameraCtrl';\r\nimport { CoinMgr } from './coin/CoinMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Main')\r\nexport class Main extends Component {\r\n    @property(Camera)\r\n    camera3D:Camera = null;\r\n\r\n    @property(Camera)\r\n    camera2D:Camera = null;\r\n    public static ins: Main = null;\r\n\r\n    _game:CoinMgr = null;\r\n    \r\n\r\n    onLoad() {\r\n        Main.ins = this;\r\n    }\r\n\r\n    async start() {\r\n        await this.loadRes();\r\n    }\r\n\r\n    /**\r\n     * @description: init game\r\n     * @return {*}\r\n     */\r\n    initGame() {\r\n        this.createLayers();\r\n        aa.res.getUI(ui.ToastView);\r\n        aa.res.getUI(ui.ActionView);\r\n        this.startGame();\r\n    }\r\n\r\n    /**\r\n     * @en : create 2D/3D root layers\r\n     * @cn : 创建2d和3d根节点\r\n     */\r\n    createLayers(){\r\n        const scene = director.getScene();\r\n        const canvas = scene.getComponentInChildren(Canvas).node;\r\n        const layer2D = aa.global.layer2D;\r\n        for (var i = 0; i <= 7; i++) {\r\n            /* if layer0 exist, we clone it, otherwise create a new one */\r\n            const node = layer2D[0] ? instantiate(layer2D[0]) : aa.utils.createUI();\r\n            node.name = \"layer2D\" + i;\r\n            node.parent = canvas;\r\n            layer2D[i] = node;\r\n        }\r\n        const layer3D = aa.global.layer3D;\r\n\r\n        for (var i = 0; i <= 4; i++) {\r\n            /* if layer0 exist, we clone it, otherwise create a new one */\r\n            const node = new Node();\r\n            node.name = \"layer3D\" + i;\r\n            node.parent = this.node.parent;\r\n            layer3D[i] = node;\r\n        }\r\n        const cameras = aa.global.cameras;\r\n        cameras[0] = this.camera3D;\r\n        cameras[1] = this.camera2D;\r\n\r\n    }\r\n\r\n    startGame() {\r\n        if(sys.isMobile || DEBUG){\r\n            aa.res.getUI(ui.JoystickView);\r\n        }\r\n        aa.res.getNode(\"Land\",aa.layer3D[0]);\r\n        /* init player */\r\n        const cam = this.camera3D.getComponent(CameraCtrl);\r\n        cam.target = aa.global.player = aa.res.getNode(\"Player\",aa.layer3D[1]);\r\n        cam.init();\r\n        director.emit(events.Toast, \"UI and Logic by iwae, a lovely chick, with a lot love ^ ^\", 5);\r\n        aa.sound.startBgm(\"bgm\");\r\n        this._game = this.node.addComponent(CoinMgr);\r\n\r\n    }\r\n\r\n\r\n    /* load game res */\r\n    async loadRes() {\r\n        await aa.res.loadBundle(1, 0.1);\r\n        await aa.res.loadRes(1, AssetType.Prefab, 0.8);\r\n        await aa.res.loadRes(1, AssetType.Sound, 0.1);\r\n    }\r\n\r\n}\r\n\r\n"]}